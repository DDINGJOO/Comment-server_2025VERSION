# 댓글 서비스 구현

----

## 디자인에서 도출한  요구사항 정리

- [x] 게시글 마다 댓글 ,답글이 있음
- [x] 수정된 댓글은 -수정됨- 표기가 있어야함.
- [x] 댓글에 사진 이모티콘 기능은 지원하지 않음
- [x] 답글은 최대 2뎁스
- [ ] 신고관련하여 비활성화 댓글은 다르게 표기
-

--- 

## 디자인에서 도출한 댓글 erd

![스크린샷 2025-10-03 오후 3.55.53.png](readmeImage/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-10-03%20%EC%98%A4%ED%9B%84%203.55.53.png)

1. 명확한 트리 표현 (parent/root)
	- parent_comment_id와 root_comment_id로 댓글-답글 계층 구조를 직관적으로 표현하여 스레드 조회 및 그룹화가 쉬움.
2. 빠른 루트/뎁스 필터링 (depth 컬럼)

- depth를 인덱싱하거나 WHERE depth = 0 으로 루트만 빠르게 조회할 수 있어 루트 기반 페이징/쿼리 성능 향상.

3. 소프트 삭제 지원 (is_deleted + deleted_at)
	- 복구/감사/심사 워크플로우에 유리하고 물리삭제로 인한 데이터 손실을 방지함.
4. 상태 관리 용이 (status 컬럼)
	- 신고·검토·차단 등 다양한 상태를 enum 문자열로 관리해 비즈니스 로직(숨김, 관리자 표시 등) 적용이 간편.
5. 자식 수 캐싱으로 빠른 집계 (reply_count)
	- reply_count로 자식 댓글 수를 빠르게 노출 가능. 빈번한 집계 쿼리 비용을 줄여 UX 개선.
6. 외부 서비스와 낮은 결합도 (article_id / writer_id without FK)
	- 아티클/유저가 다른 마이크로서비스에서 관리되므로 DB 레벨 FK를 걸지 않아 분산 환경에서의 의존성 문제 방지.
7. 범용 타임스탬프(생성/수정/삭제) 제공
	- created_at/updated_at/deleted_at으로 UI의 edited 여부 판단, 변경 이력 표시, 시간 기반 정렬/필터링이 쉬움.

8. 추가 기능(첨부, 리액션, 신고 등)을 별도 테이블로 분리하기 쉬운 정규화된 기본 구조. Outbox 등 이벤트 패턴 도입도 자연스러움.
	- 운영·정합성 관리가 용이
	- depth 범위 체크(CHECK 제약)와 트랜잭션 내 depth 계산으로 반정규화의 정합성 보장 가능. 정합성 검사·배치 보정 적용도 수월.
